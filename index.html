<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åƒ¹æ ¼å”å•†æ¨¡æ“¬å™¨ Pro</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Microsoft JhengHei', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(45deg, #2c5aa0, #1e3c72);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }
        
        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }
        
        .main-content {
            display: flex;
            min-height: 80vh;
        }
        
        .setup-panel {
            width: 30%;
            background: #f8f9fa;
            padding: 25px;
            border-right: 1px solid #e9ecef;
            overflow-y: auto;
        }
        
        .simulation-panel {
            width: 50%;
            padding: 25px;
        }
        
        .analytics-panel {
            width: 20%;
            background: #f1f3f4;
            padding: 20px;
            border-left: 1px solid #e9ecef;
            overflow-y: auto;
        }
        
        .section {
            margin-bottom: 25px;
        }
        
        .section h3 {
            color: #2c5aa0;
            margin-bottom: 15px;
            font-size: 1.2rem;
            border-bottom: 2px solid #2c5aa0;
            padding-bottom: 5px;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #333;
            font-size: 0.9rem;
        }
        
        .form-group select, .form-group input, .form-group textarea {
            width: 100%;
            padding: 8px;
            border: 2px solid #e9ecef;
            border-radius: 6px;
            font-size: 0.9rem;
            transition: border-color 0.3s;
        }
        
        .form-group select:focus, .form-group input:focus, .form-group textarea:focus {
            outline: none;
            border-color: #2c5aa0;
        }
        
        .negotiation-items {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
            margin-top: 10px;
        }
        
        .negotiation-item {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 6px;
            background: white;
            border-radius: 4px;
            border: 1px solid #e9ecef;
            font-size: 0.8rem;
        }
        
        .negotiation-item input[type="checkbox"] {
            width: auto;
        }
        
        .start-btn {
            background: linear-gradient(45deg, #28a745, #20c997);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            width: 100%;
            transition: transform 0.2s;
        }
        
        .start-btn:hover {
            transform: translateY(-2px);
        }
        
        .round-indicator {
            background: #2c5aa0;
            color: white;
            text-align: center;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 15px;
            font-size: 1.1rem;
            font-weight: bold;
        }
        
        .role-switch {
            display: flex;
            gap: 8px;
            margin-bottom: 15px;
        }
        
        .role-btn {
            flex: 1;
            padding: 10px;
            border: 2px solid #2c5aa0;
            background: white;
            color: #2c5aa0;
            border-radius: 6px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
            font-size: 0.9rem;
        }
        
        .role-btn.active {
            background: #2c5aa0;
            color: white;
        }
        
        .negotiation-interface {
            display: none;
        }
        
        .negotiation-interface.active {
            display: block;
        }
        
        .current-terms {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
        }
        
        .terms-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 10px;
        }
        
        .term-item {
            background: white;
            padding: 10px;
            border-radius: 6px;
            border-left: 3px solid #2c5aa0;
        }
        
        .term-label {
            font-weight: bold;
            color: #2c5aa0;
            margin-bottom: 3px;
            font-size: 0.85rem;
        }
        
        .term-value {
            font-size: 0.9rem;
            color: #333;
        }
        
        .conversation-area {
            background: #fff;
            border: 2px solid #e9ecef;
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 15px;
            max-height: 350px;
            overflow-y: auto;
        }
        
        .message {
            margin-bottom: 15px;
            display: flex;
            gap: 10px;
            align-items: flex-start;
        }
        
        .message.user {
            flex-direction: row-reverse;
        }
        
        .message-avatar {
            width: 35px;
            height: 35px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1rem;
            font-weight: bold;
            color: white;
            flex-shrink: 0;
        }
        
        .message.user .message-avatar {
            background: #2c5aa0;
        }
        
        .message.ai .message-avatar {
            background: #28a745;
        }
        
        .message.expert .message-avatar {
            background: #ffc107;
            color: #333;
        }
        
        .message.event .message-avatar {
            background: #dc3545;
        }
        
        .message-content {
            background: #f8f9fa;
            padding: 12px 15px;
            border-radius: 15px;
            max-width: 80%;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            font-size: 0.9rem;
        }
        
        .message.user .message-content {
            background: #2c5aa0;
            color: white;
        }
        
        .message.expert .message-content {
            background: #fff3cd;
            border: 1px solid #ffc107;
        }
        
        .message.event .message-content {
            background: #f8d7da;
            border: 1px solid #dc3545;
        }
        
        .message-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 6px;
            font-size: 0.8rem;
            opacity: 0.7;
        }
        
        .input-area {
            background: white;
            border: 2px solid #e9ecef;
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 15px;
        }
        
        .message-input {
            width: 100%;
            min-height: 80px;
            padding: 12px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 0.9rem;
            resize: vertical;
            font-family: inherit;
        }
        
        .message-input:focus {
            outline: none;
            border-color: #2c5aa0;
        }
        
        .quick-actions {
            margin-top: 10px;
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
        }
        
        .quick-action-btn {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            padding: 5px 10px;
            border-radius: 15px;
            cursor: pointer;
            font-size: 0.8rem;
            transition: all 0.3s;
        }
        
        .quick-action-btn:hover {
            background: #2c5aa0;
            color: white;
            border-color: #2c5aa0;
        }
        
        .send-btn {
            background: linear-gradient(45deg, #28a745, #20c997);
            color: white;
            border: none;
            padding: 10px 25px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: bold;
            cursor: pointer;
            margin-top: 10px;
            transition: transform 0.2s;
        }
        
        .send-btn:hover {
            transform: translateY(-2px);
        }
        
        .strategy-tips {
            background: linear-gradient(45deg, #ffeaa7, #fab1a0);
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
            font-size: 0.9rem;
        }
        
        .tip-title {
            font-weight: bold;
            color: #2d3436;
            margin-bottom: 8px;
        }
        
        .score-display {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .score-number {
            font-size: 2rem;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .score-breakdown {
            background: white;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
        }
        
        .score-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
            font-size: 0.85rem;
        }
        
        .score-bar {
            width: 60px;
            height: 8px;
            background: #e9ecef;
            border-radius: 4px;
            overflow: hidden;
        }
        
        .score-fill {
            height: 100%;
            background: linear-gradient(45deg, #28a745, #20c997);
            transition: width 0.3s;
        }
        
        .expert-insights {
            background: #fff3cd;
            border: 1px solid #ffc107;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 15px;
        }
        
        .expert-title {
            font-weight: bold;
            color: #856404;
            margin-bottom: 8px;
            font-size: 0.9rem;
        }
        
        .performance-chart {
            background: white;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
        }
        
        .chart-title {
            font-weight: bold;
            margin-bottom: 10px;
            color: #2c5aa0;
            font-size: 0.9rem;
        }
        
        .chart-bar {
            display: flex;
            align-items: center;
            margin-bottom: 8px;
            font-size: 0.8rem;
        }
        
        .chart-label {
            width: 80px;
            font-size: 0.75rem;
        }
        
        .chart-progress {
            flex: 1;
            height: 12px;
            background: #e9ecef;
            border-radius: 6px;
            margin: 0 8px;
            overflow: hidden;
        }
        
        .chart-value {
            font-weight: bold;
            color: #2c5aa0;
            font-size: 0.75rem;
        }
        
        .batna-section {
            background: #e8f5e8;
            border: 1px solid #28a745;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        
        .batna-title {
            font-weight: bold;
            color: #28a745;
            margin-bottom: 10px;
        }
        
        .event-alert {
            background: #f8d7da;
            border: 1px solid #dc3545;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 15px;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.7; }
            100% { opacity: 1; }
        }
        
        .hidden {
            display: none;
        }
        
        @media (max-width: 1200px) {
            .main-content {
                flex-direction: column;
            }
            
            .setup-panel, .simulation-panel, .analytics-panel {
                width: 100%;
            }
            
            .analytics-panel {
                border-left: none;
                border-top: 1px solid #e9ecef;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ’¼ åƒ¹æ ¼å”å•†æ¨¡æ“¬å™¨ Pro</h1>
            <p>AIé©…å‹•çš„æ™ºèƒ½å”å•†è¨“ç·´å¹³å°</p>
        </div>
        
        <div class="main-content">
            <div class="setup-panel">
                <div class="section">
                    <h3>ğŸ”’ ç§äººBATNAè¨­å®š</h3>
                    <div class="batna-section">
                        <div class="batna-title">ğŸ¤ æ‚¨çš„æœ€ä½³æ›¿ä»£æ–¹æ¡ˆ (åƒ…æ‚¨å¯è¦‹)</div>
                        <div class="form-group">
                            <label>æ›¿ä»£é¸æ“‡ï¼š</label>
                            <input type="text" id="batnaOption" placeholder="ä¾‹ï¼šèˆ‡ABCå…¬å¸åˆä½œï¼Œå ±åƒ¹103è¬">
                        </div>
                        <div class="form-group">
                            <label>æ›¿ä»£æ–¹æ¡ˆåƒ¹å€¼è©•ä¼°ï¼š</label>
                            <select id="batnaValue">
                                <option value="poor">è¼ƒå·® (è¿«åˆ‡éœ€è¦é”æˆå”è­°)</option>
                                <option value="fair">æ™®é€š (æœ‰ä¸€äº›è«‡åˆ¤ç©ºé–“)</option>
                                <option value="good">è‰¯å¥½ (ä¸æ€•è«‡åˆ¤ç ´è£‚)</option>
                                <option value="excellent">å„ªç§€ (æ¡æœ‰ä¸»å°æ¬Š)</option>
                            </select>
                        </div>
                        <div style="font-size: 0.8rem; color: #666; margin-top: 10px;">
                            ğŸ’¡ æ‚¨çš„BATNAä¸æœƒè¢«å°æ–¹çŸ¥é“ï¼Œä½†æœƒå½±éŸ¿æ‚¨çš„è«‡åˆ¤ä¿¡å¿ƒå’Œç­–ç•¥å»ºè­°
                        </div>
                    </div>
                </div>
                
                <div class="section">
                    <h3>ğŸ­ ç”¢æ¥­æƒ…å¢ƒè¨­å®š</h3>
                    <div class="form-group">
                        <label>é¸æ“‡ç”¢æ¥­é¡å‹ï¼š</label>
                        <select id="industry">
                            <option value="manufacturing">è£½é€ æ¥­ (B2Bå…ƒä»¶æ¡è³¼)</option>
                            <option value="software">è»Ÿé«”æ¥­ (ä¼æ¥­è§£æ±ºæ–¹æ¡ˆ)</option>
                            <option value="logistics">ç‰©æµæ¥­ (é‹è¼¸æœå‹™)</option>
                            <option value="consulting">é¡§å•æ¥­ (å°ˆæ¥­æœå‹™)</option>
                            <option value="retail">é›¶å”®æ¥­ (ä¾›æ‡‰å•†åˆä½œ)</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label>å”å•†è¦æ¨¡ï¼š</label>
                        <select id="scale">
                            <option value="small">å°å‹é …ç›® (10-50è¬)</option>
                            <option value="medium">ä¸­å‹é …ç›® (50-500è¬)</option>
                            <option value="large">å¤§å‹é …ç›® (500è¬ä»¥ä¸Š)</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label>æ‚¨çš„è§’è‰²ï¼š</label>
                        <select id="role">
                            <option value="buyer">æ¡è³¼æ–¹ (Buyer)</option>
                            <option value="supplier">ä¾›æ‡‰å•† (Supplier)</option>
                        </select>
                    </div>
                </div>
                
                <div class="section">
                    <h3>ğŸ“‹ å”å•†è¦ç´ é¸æ“‡</h3>
                    <p style="margin-bottom: 15px; color: #666; font-size: 0.9rem;">é¸æ“‡æœ¬æ¬¡å”å•†æ¶‰åŠçš„é …ç›®ï¼š</p>
                    <div class="negotiation-items">
                        <div class="negotiation-item">
                            <input type="checkbox" id="price" checked>
                            <label for="price">ğŸ’° å–®åƒ¹/ç¸½åƒ¹</label>
                        </div>
                        <div class="negotiation-item">
                            <input type="checkbox" id="quantity">
                            <label for="quantity">ğŸ“¦ æ•¸é‡/è¦æ¨¡</label>
                        </div>
                        <div class="negotiation-item">
                            <input type="checkbox" id="payment">
                            <label for="payment">ğŸ’³ ä»˜æ¬¾æ¢ä»¶</label>
                        </div>
                        <div class="negotiation-item">
                            <input type="checkbox" id="delivery">
                            <label for="delivery">ğŸšš äº¤æœŸ/äº¤ä»˜</label>
                        </div>
                        <div class="negotiation-item">
                            <input type="checkbox" id="quality">
                            <label for="quality">â­ å“è³ªæ¨™æº–</label>
                        </div>
                        <div class="negotiation-item">
                            <input type="checkbox" id="warranty">
                            <label for="warranty">ğŸ›¡ï¸ ä¿å›º/æœå‹™</label>
                        </div>
                        <div class="negotiation-item">
                            <input type="checkbox" id="volume">
                            <label for="volume">ğŸ“ˆ æœªä¾†åˆä½œé‡</label>
                        </div>
                        <div class="negotiation-item">
                            <input type="checkbox" id="exclusivity">
                            <label for="exclusivity">ğŸ¤ å°ˆå±¬åˆä½œ</label>
                        </div>
                    </div>
                </div>
                
                <div class="section">
                    <h3>ğŸ¯ æ¨¡æ“¬è¨­å®š</h3>
                    <div class="form-group">
                        <label>åˆå§‹é ç®—/å ±åƒ¹ (è¬å…ƒ)ï¼š</label>
                        <input type="number" id="initialBudget" placeholder="ä¾‹ï¼š100" min="1">
                    </div>
                    
                    <div class="form-group">
                        <label>æœŸæœ›å”å•†è¼ªæ•¸ï¼š</label>
                        <select id="rounds">
                            <option value="3">3è¼ª (å¿«é€Ÿè«‡åˆ¤)</option>
                            <option value="5" selected>5è¼ª (æ¨™æº–è«‡åˆ¤)</option>
                            <option value="7">7è¼ª (è¤‡é›œè«‡åˆ¤)</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label>çªç™¼äº‹ä»¶å¼·åº¦ï¼š</label>
                        <select id="eventIntensity">
                            <option value="none">ç„¡çªç™¼äº‹ä»¶</option>
                            <option value="low">è¼•åº¦æŒ‘æˆ°</option>
                            <option value="medium" selected>ä¸­åº¦æŒ‘æˆ°</option>
                            <option value="high">é«˜å¼·åº¦æŒ‘æˆ°</option>
                        </select>
                    </div>
                </div>
                
                <button class="start-btn" onclick="startNegotiation()">ğŸš€ é–‹å§‹å”å•†æ¨¡æ“¬</button>
            </div>
            
            <div class="simulation-panel">
                <div id="welcome-screen">
                    <div style="text-align: center; padding: 40px; color: #666;">
                        <h2>æ­¡è¿ä¾†åˆ°åƒ¹æ ¼å”å•†æ¨¡æ“¬å™¨ Pro</h2>
                        <p style="margin-top: 20px; font-size: 1.1rem;">
                            ğŸ¯ <strong>å”å•†æ¨¡æ“¬ç‰¹è‰²ï¼š</strong><br><br>
                            ğŸ”’ <strong>éš±ç§BATNA</strong>ï¼šæ‚¨çš„åº•ç‰Œä¸æœƒæ´©éœ²çµ¦å°æ–¹<br>
                            ğŸª <strong>å¤šå…ƒå”å•†</strong>ï¼šAIæœƒéˆæ´»é‹ç”¨æ‰€æœ‰é¸å®šè¦ç´ <br>
                            ğŸ“¢ <strong>çœŸå¯¦çªç™¼äº‹ä»¶</strong>ï¼šæ”¹è®Šè«‡åˆ¤å±€å‹¢çš„é‡å¤§äº‹ä»¶<br>
                            ğŸ“Š <strong>å°ˆæ¥­è©•åˆ†</strong>ï¼šå³æ™‚æŠ€å·§åˆ†æå’Œæ”¹é€²å»ºè­°<br>
                            ğŸ“ <strong>å°ˆå®¶æŒ‡å°</strong>ï¼šéšæ®µæ€§å°ˆæ¥­å»ºè­°<br>
                            ğŸ“‹ <strong>å­¸ç¿’å ±å‘Š</strong>ï¼šå®Œæ•´çš„å€‹äººåŒ–è«‡åˆ¤åˆ†æ<br><br>
                            
                            <strong>ğŸ“ ä½¿ç”¨æ­¥é©Ÿï¼š</strong><br>
                            1ï¸âƒ£ è¨­å®šæ‚¨çš„BATNAï¼ˆæœ€ä½³æ›¿ä»£æ–¹æ¡ˆï¼‰<br>
                            2ï¸âƒ£ é¸æ“‡ç”¢æ¥­æƒ…å¢ƒå’Œå”å•†è¦ç´ <br>
                            3ï¸âƒ£ è¨­å®šåˆå§‹é ç®—å’Œæ¨¡æ“¬åƒæ•¸<br>
                            4ï¸âƒ£ é–‹å§‹å”å•†ä¸¦é«”é©—çœŸå¯¦è«‡åˆ¤ï¼
                        </p>
                        <p style="margin-top: 30px; color: #2c5aa0; font-weight: bold;">
                            ğŸ“š ä½¿ç”¨èªªæ˜ï¼šè¨­å®šæ‚¨çš„ç§äººBATNA â†’ é¸æ“‡ç”¢æ¥­å’Œå”å•†è¦ç´  â†’ é–‹å§‹æ¨¡æ“¬ï¼<br>
                            ğŸ’¡ æç¤ºï¼šBATNAè¨­å®šæœƒå½±éŸ¿æ‚¨çš„è«‡åˆ¤ä¿¡å¿ƒå’Œç­–ç•¥å»ºè­°ï¼Œä½†å°æ–¹æ°¸é ä¸æœƒçŸ¥é“ï¼
                        </p>
                    </div>
                </div>
                
                <div id="negotiation-screen" class="negotiation-interface">
                    <div class="round-indicator">
                        <span id="current-round">ç¬¬ 1 è¼ª</span> å”å•†é€²è¡Œä¸­
                    </div>
                    
                    <div class="role-switch">
                        <button class="role-btn active" id="buyer-view" onclick="switchRole('buyer')">
                            ğŸ›’ æ¡è³¼æ–¹è¦–è§’
                        </button>
                        <button class="role-btn" id="supplier-view" onclick="switchRole('supplier')">
                            ğŸ­ ä¾›æ‡‰å•†è¦–è§’
                        </button>
                    </div>
                    
                    <div id="event-notification" class="event-alert hidden">
                        <strong>ğŸš¨ é‡å¤§çªç™¼äº‹ä»¶ï¼š</strong><span id="event-text"></span>
                    </div>
                    
                    <div class="current-terms">
                        <h4 style="margin-bottom: 10px; color: #2c5aa0; font-size: 1rem;">ğŸ“Š ç•¶å‰å”å•†æ¢ä»¶</h4>
                        <div class="terms-grid" id="terms-display">
                            <!-- å‹•æ…‹ç”Ÿæˆæ¢ä»¶ -->
                        </div>
                    </div>
                    
                    <div class="conversation-area" id="conversation">
                        <!-- å°è©±è¨˜éŒ„ -->
                    </div>
                    
                    <div class="input-area">
                        <h4 style="margin-bottom: 10px; color: #2c5aa0; font-size: 1rem;">ğŸ’¬ æ‚¨çš„ææ¡ˆ</h4>
                        <textarea class="message-input" id="messageInput" placeholder="è¼¸å…¥æ‚¨çš„å”å•†ææ¡ˆï¼Œå¯ä»¥åŒ…å«åƒ¹æ ¼ã€æ¢ä»¶èª¿æ•´ã€ç†ç”±èªªæ˜ç­‰...&#10;ä¾‹å¦‚ï¼šæˆ‘å€‘å¸Œæœ›å°‡åƒ¹æ ¼èª¿æ•´åˆ°95è¬å…ƒï¼Œä½œç‚ºäº¤æ›ï¼Œæˆ‘å€‘å¯ä»¥æ‰¿è«¾æœªä¾†ä¸€å¹´è‡³å°‘50è¬å€‹çš„æ¡è³¼é‡..."></textarea>
                        
                        <div class="quick-actions">
                            <div class="quick-action-btn" onclick="addQuickText('åƒ¹æ ¼èª¿æ•´')">ğŸ’° åƒ¹æ ¼èª¿æ•´</div>
                            <div class="quick-action-btn" onclick="addQuickText('ä»˜æ¬¾æ¢ä»¶')">ğŸ’³ ä»˜æ¬¾æ¢ä»¶</div>
                            <div class="quick-action-btn" onclick="addQuickText('äº¤æœŸè¦æ±‚')">ğŸšš äº¤æœŸè¦æ±‚</div>
                            <div class="quick-action-btn" onclick="addQuickText('æ•¸é‡æ‰¿è«¾')">ğŸ“¦ æ•¸é‡æ‰¿è«¾</div>
                            <div class="quick-action-btn" onclick="addQuickText('å“è³ªä¿è­‰')">â­ å“è³ªä¿è­‰</div>
                            <div class="quick-action-btn" onclick="addQuickText('é•·æœŸåˆä½œ')">ğŸ¤ é•·æœŸåˆä½œ</div>
                        </div>
                        
                        <button class="send-btn" onclick="sendMessage()">ğŸ“¤ ç™¼é€ææ¡ˆ</button>
                    </div>
                    
                    <div class="strategy-tips">
                        <div class="tip-title">ğŸ’¡ AIç­–ç•¥åŠ©æ‰‹</div>
                        <div id="current-tip">
                            æ ¹æ“šæ‚¨çš„è¨­å®šå’Œç•¶å‰æƒ…æ³ï¼Œç­–ç•¥å»ºè­°å°‡åœ¨é€™è£¡é¡¯ç¤º...
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="analytics-panel">
                <div class="section">
                    <h3>ğŸ“Š å³æ™‚è©•åˆ†</h3>
                    <div class="score-display">
                        <div class="score-number" id="overall-score">--</div>
                        <div>ç¸½é«”è¡¨ç¾</div>
                    </div>
                    
                    <div class="score-breakdown">
                        <h4 style="margin-bottom: 10px; font-size: 0.9rem;">æŠ€å·§åˆ†æ</h4>
                        <div class="score-item">
                            <span>æºé€šæŠ€å·§</span>
                            <div class="score-bar">
                                <div class="score-fill" id="communication-bar" style="width: 0%"></div>
                            </div>
                            <span id="communication-score">--</span>
                        </div>
                        <div class="score-item">
                            <span>ç­–ç•¥é‹ç”¨</span>
                            <div class="score-bar">
                                <div class="score-fill" id="strategy-bar" style="width: 0%"></div>
                            </div>
                            <span id="strategy-score">--</span>
                        </div>
                        <div class="score-item">
                            <span>æ¢ä»¶äº¤æ›</span>
                            <div class="score-bar">
                                <div class="score-fill" id="exchange-bar" style="width: 0%"></div>
                            </div>
                            <span id="exchange-score">--</span>
                        </div>
                        <div class="score-item">
                            <span>çµæœé”æˆ</span>
                            <div class="score-bar">
                                <div class="score-fill" id="result-bar" style="width: 0%"></div>
                            </div>
                            <span id="result-score">--</span>
                        </div>
                    </div>
                </div>
                
                <div class="section">
                    <h3>ğŸ“ å°ˆå®¶é»è©•</h3>
                    <div class="expert-insights" id="expert-feedback">
                        <div class="expert-title">å”å•†å°ˆå®¶å»ºè­°</div>
                        <div id="expert-text">è¨­å®šå¥½æ‚¨çš„BATNAå’Œå”å•†åƒæ•¸å¾Œï¼Œå°ˆå®¶å»ºè­°å°‡æœƒåœ¨é€™è£¡å‡ºç¾ã€‚è¨˜ä½ï¼šBATNAæ˜¯æ‚¨è«‡åˆ¤çš„é‡è¦å¾Œç›¾ï¼</div>
                    </div>
                </div>
                
                <div class="section">
                    <h3>ğŸ“ˆ è¡¨ç¾è¿½è¹¤</h3>
                    <div class="performance-chart">
                        <div class="chart-title">æ­·å²è¡¨ç¾</div>
                        <div class="chart-bar">
                            <div class="chart-label">æœ¬æ¬¡</div>
                            <div class="chart-progress">
                                <div class="score-fill" id="current-progress" style="width: 0%"></div>
                            </div>
                            <div class="chart-value" id="current-value">--</div>
                        </div>
                        <div class="chart-bar">
                            <div class="chart-label">å¹³å‡</div>
                            <div class="chart-progress">
                                <div class="score-fill" id="average-progress" style="width: 75%"></div>
                            </div>
                            <div class="chart-value">75</div>
                        </div>
                        <div class="chart-bar">
                            <div class="chart-label">æœ€ä½³</div>
                            <div class="chart-progress">
                                <div class="score-fill" id="best-progress" style="width: 88%"></div>
                            </div>
                            <div class="chart-value">88</div>
                        </div>
                    </div>
                </div>
                
                <div class="section">
                    <h3>ğŸ¯ è«‡åˆ¤é¢¨æ ¼</h3>
                    <div id="negotiation-style" style="padding: 10px; background: white; border-radius: 6px; font-size: 0.85rem;">
                        <strong>åˆ†æä¸­...</strong><br>
                        å®Œæˆå”å•†å¾Œå°‡é¡¯ç¤ºæ‚¨çš„è«‡åˆ¤é¢¨æ ¼ç‰¹å¾µ
                    </div>
                </div>
                
                <div class="section">
                    <h3>ğŸ“‹ å­¸ç¿’å ±å‘Š</h3>
                    <button id="generate-report" onclick="generateLearningReport()" 
                            style="width: 100%; padding: 8px; background: #2c5aa0; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 0.85rem;"
                            disabled>
                        ç”Ÿæˆå­¸ç¿’å ±å‘Š
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        let currentRound = 1;
        let maxRounds = 5;
        let currentRole = 'buyer';
        let selectedItems = [];
        let negotiationHistory = [];
        let currentTerms = {};
        let lastOffer = {};
        let scores = {
            communication: 0,
            strategy: 0,
            exchange: 0,
            result: 0,
            overall: 0
        };
        let eventTriggered = false;
        let batnaSettings = {};
        let learningData = {
            rounds: [],
            strategies: [],
            outcomes: [],
            style: 'analyzing'
        };
        
        // çªç™¼äº‹ä»¶æ¨¡æ¿
        const criticalEvents = {
            low: [
                {
                    trigger: 2,
                    type: 'minor_issue',
                    message: 'å°æ–¹æåˆ°ä¸Šå­£äº¤è²¨æœ‰å°å»¶é²ï¼Œå¸Œæœ›é€™æ¬¡èƒ½æ”¹å–„',
                    impact: 'dialogue'
                }
            ],
            medium: [
                {
                    trigger: 2,
                    type: 'market_shift',
                    message: 'é‡è¦åŸææ–™åƒ¹æ ¼çªç„¶ä¸Šæ¼²12%ï¼Œæˆæœ¬å£“åŠ›å¢åŠ ',
                    impact: 'strategy_change',
                    priceAdjustment: 1.08
                },
                {
                    trigger: 3,
                    type: 'competitor_threat',
                    message: 'ç«¶çˆ­å°æ‰‹å‰›ç™¼å¸ƒæ–°å ±åƒ¹ï¼Œæ¯”ç›®å‰æ¢ä»¶å„ªæƒ 15%',
                    impact: 'pressure'
                }
            ],
            high: [
                {
                    trigger: 2,
                    type: 'industry_crisis',
                    message: 'è¡Œæ¥­ç™¼ç”Ÿé‡å¤§äº‹ä»¶ï¼Œä¾›æ‡‰éˆé¢è‡¨3å€‹æœˆçŸ­ç¼ºé¢¨éšª',
                    impact: 'game_changer'
                },
                {
                    trigger: 4,
                    type: 'regulatory_change',
                    message: 'æ”¿åºœçªç„¶å®£å¸ƒæ–°æ³•è¦ï¼Œéœ€è¦å¢åŠ 25%çš„åˆè¦æˆæœ¬',
                    impact: 'cost_restructure',
                    priceAdjustment: 1.25
                }
            ]
        };
        
        // ç”¢æ¥­ç‰¹å®šçš„å”å•†é‡é»å’ŒAIäººæ ¼
        const industryTemplates = {
            manufacturing: {
                name: 'è£½é€ æ¥­',
                keyFocus: ['åƒ¹æ ¼', 'å“è³ªæ¨™æº–', 'äº¤æœŸ', 'æœªä¾†åˆä½œé‡'],
                scenarios: {
                    buyer: 'æ‚¨æ˜¯ä¸€å®¶ç§‘æŠ€å…¬å¸çš„æ¡è³¼ç¶“ç†ï¼Œéœ€è¦æ¡è³¼é—œéµå…ƒä»¶',
                    supplier: 'æ‚¨æ˜¯å°ˆæ¥­å…ƒä»¶è£½é€ å•†ï¼Œæ“æœ‰æŠ€è¡“å„ªå‹¢ä½†ç”¢èƒ½æœ‰é™'
                },
                aiPersonality: {
                    buyer: {
                        priceRange: 0.92,
                        priorities: ['åƒ¹æ ¼', 'å“è³ª', 'äº¤æœŸ'],
                        style: 'å‹™å¯¦ä¸”æ³¨é‡æˆæœ¬æ§åˆ¶',
                        negotiationElements: ['price', 'quality', 'delivery', 'warranty']
                    },
                    supplier: {
                        priceRange: 1.08,
                        priorities: ['å“è³ª', 'ä»˜æ¬¾æ¢ä»¶', 'æ•¸é‡'],
                        style: 'å¼·èª¿æŠ€è¡“åƒ¹å€¼å’Œå“è³ªä¿è­‰',
                        negotiationElements: ['price', 'payment', 'volume', 'exclusivity']
                    }
                }
            },
            software: {
                name: 'è»Ÿé«”æ¥­',
                keyFocus: ['æˆæ¬Šè²»ç”¨', 'æœå‹™ç­‰ç´š', 'å®¢è£½åŒ–ç¨‹åº¦', 'æ”¯æ´æœå‹™'],
                scenarios: {
                    buyer: 'æ‚¨éœ€è¦ç‚ºå…¬å¸æ¡è³¼ä¼æ¥­è»Ÿé«”è§£æ±ºæ–¹æ¡ˆ',
                    supplier: 'æ‚¨æ˜¯è»Ÿé«”å…¬å¸æ¥­å‹™ä»£è¡¨ï¼Œæä¾›ä¼æ¥­è§£æ±ºæ–¹æ¡ˆ'
                },
                aiPersonality: {
                    buyer: {
                        priceRange: 0.88,
                        priorities: ['åƒ¹æ ¼', 'åŠŸèƒ½', 'æ”¯æ´'],
                        style: 'é‡è¦–ROIå’Œé•·æœŸåƒ¹å€¼',
                        negotiationElements: ['price', 'warranty', 'payment', 'quality']
                    },
                    supplier: {
                        priceRange: 1.15,
                        priorities: ['å®¢è£½åŒ–', 'æ”¯æ´æœå‹™', 'æˆæ¬Šæ¨¡å¼'],
                        style: 'å¼·èª¿è§£æ±ºæ–¹æ¡ˆåƒ¹å€¼å’Œæœå‹™å“è³ª',
                        negotiationElements: ['price', 'quality', 'warranty', 'volume']
                    }
                }
            },
            logistics: {
                name: 'ç‰©æµæ¥­',
                keyFocus: ['é‹è²»', 'æœå‹™ç¯„åœ', 'æ™‚æ•ˆä¿è­‰', 'ä¿éšªè²¬ä»»'],
                scenarios: {
                    buyer: 'æ‚¨éœ€è¦æ‰¾åˆ°å¯é çš„ç‰©æµåˆä½œå¤¥ä¼´',
                    supplier: 'æ‚¨æ˜¯ç‰©æµå…¬å¸æ¥­å‹™ï¼Œå¸Œæœ›æ‹“å±•æ–°å®¢æˆ¶'
                },
                aiPersonality: {
                    buyer: {
                        priceRange: 0.94,
                        priorities: ['åƒ¹æ ¼', 'æ™‚æ•ˆ', 'æœå‹™ç¯„åœ'],
                        style: 'æ³¨é‡æœå‹™ç©©å®šæ€§å’Œæˆæœ¬æ•ˆç›Š',
                        negotiationElements: ['price', 'delivery', 'warranty', 'payment']
                    },
                    supplier: {
                        priceRange: 1.06,
                        priorities: ['æœå‹™ç¯„åœ', 'ä¿éšª', 'é•·æœŸåˆç´„'],
                        style: 'å¼·èª¿æœå‹™ç¶²è·¯å’Œå°ˆæ¥­èƒ½åŠ›',
                        negotiationElements: ['price', 'delivery', 'volume', 'exclusivity']
                    }
                }
            },
            consulting: {
                name: 'é¡§å•æ¥­',
                keyFocus: ['é¡§å•è²»ç‡', 'é …ç›®ç¯„åœ', 'äº¤ä»˜æ™‚ç¨‹', 'æˆæœä¿è­‰'],
                scenarios: {
                    buyer: 'æ‚¨éœ€è¦è˜è«‹å°ˆæ¥­é¡§å•å”åŠ©æ¥­å‹™è½‰å‹',
                    supplier: 'æ‚¨æ˜¯è³‡æ·±é¡§å•ï¼Œæä¾›å°ˆæ¥­è«®è©¢æœå‹™'
                },
                aiPersonality: {
                    buyer: {
                        priceRange: 0.90,
                        priorities: ['åƒ¹æ ¼', 'å°ˆæ¥­èƒ½åŠ›', 'äº¤æœŸ'],
                        style: 'é‡è¦–å°ˆæ¥­åƒ¹å€¼å’Œå¯¦éš›æˆæ•ˆ',
                        negotiationElements: ['price', 'quality', 'delivery', 'warranty']
                    },
                    supplier: {
                        priceRange: 1.12,
                        priorities: ['å°ˆæ¥­èªçŸ¥', 'é …ç›®ç¯„åœ', 'é•·æœŸé—œä¿‚'],
                        style: 'å¼·èª¿å°ˆæ¥­åƒ¹å€¼å’Œè§£æ±ºæ–¹æ¡ˆæ·±åº¦',
                        negotiationElements: ['price', 'quality', 'volume', 'exclusivity']
                    }
                }
            },
            retail: {
                name: 'é›¶å”®æ¥­',
                keyFocus: ['é€²è²¨åƒ¹æ ¼', 'éŠ·å”®æ”¯æ´', 'é€€æ›è²¨æ”¿ç­–', 'ç¨å®¶ä»£ç†'],
                scenarios: {
                    buyer: 'æ‚¨æ˜¯é›¶å”®å•†æ¡è³¼ä¸»ç®¡ï¼Œå°‹æ‰¾æ–°çš„ä¾›æ‡‰å•†',
                    supplier: 'æ‚¨æ˜¯å“ç‰Œå•†æ¥­å‹™ï¼Œå¸Œæœ›é€²å…¥æ–°çš„é›¶å”®é€šè·¯'
                },
                aiPersonality: {
                    buyer: {
                        priceRange: 0.88,
                        priorities: ['åƒ¹æ ¼', 'éŠ·å”®æ”¯æ´', 'é€€æ›æ”¿ç­–'],
                        style: 'æ³¨é‡éŠ·å”®è¡¨ç¾å’Œé¢¨éšªæ§åˆ¶',
                        negotiationElements: ['price', 'payment', 'warranty', 'volume']
                    },
                    supplier: {
                        priceRange: 1.10,
                        priorities: ['é€šè·¯è¦†è“‹', 'å“ç‰Œå½¢è±¡', 'éŠ·å”®é‡'],
                        style: 'å¼·èª¿å“ç‰Œåƒ¹å€¼å’Œå¸‚å ´æ©Ÿæœƒ',
                        negotiationElements: ['price', 'volume', 'exclusivity', 'delivery']
                    }
                }
            }
        };
        
        function startNegotiation() {
            // æª¢æŸ¥BATNAè¨­å®š
            batnaSettings = {
                option: document.getElementById('batnaOption').value.trim(),
                value: document.getElementById('batnaValue').value
            };
            
            if (!batnaSettings.option) {
                alert('è«‹è¨­å®šæ‚¨çš„BATNAï¼ˆæœ€ä½³æ›¿ä»£æ–¹æ¡ˆï¼‰å¾Œå†é–‹å§‹å”å•†ï¼\n\nä¾‹å¦‚ï¼šèˆ‡ABCå…¬å¸åˆä½œï¼Œå ±åƒ¹103è¬');
                return;
            }
            
            // æ”¶é›†åŸºæœ¬è¨­å®š
            const industry = document.getElementById('industry').value;
            maxRounds = parseInt(document.getElementById('rounds').value);
            currentRole = document.getElementById('role').value;
            
            // æ”¶é›†é¸ä¸­çš„å”å•†é …ç›®
            selectedItems = [];
            const checkboxes = document.querySelectorAll('.negotiation-item input[type="checkbox"]');
            checkboxes.forEach(cb => {
                if (cb.checked) {
                    selectedItems.push(cb.id);
                }
            });
            
            if (selectedItems.length === 0) {
                alert('è«‹è‡³å°‘é¸æ“‡ä¸€å€‹å”å•†é …ç›®ï¼');
                return;
            }
            
            // æª¢æŸ¥åˆå§‹é ç®—
            const initialBudget = document.getElementById('initialBudget').value;
            if (!initialBudget) {
                alert('è«‹è¨­å®šåˆå§‹é ç®—/å ±åƒ¹ï¼');
                return;
            }
            
            // åˆå§‹åŒ–å”å•†æ¢ä»¶
            initializeTerms();
            
            // é‡ç½®å”å•†ç‹€æ…‹
            currentRound = 1;
            eventTriggered = false;
            negotiationHistory = [];
            learningData = {
                rounds: [],
                strategies: [],
                outcomes: [],
                style: 'analyzing'
            };
            scores = {
                communication: 0,
                strategy: 0,
                exchange: 0,
                result: 0,
                overall: 0
            };
            
            // åˆ‡æ›åˆ°å”å•†ç•Œé¢
            document.getElementById('welcome-screen').style.display = 'none';
            document.getElementById('negotiation-screen').style.display = 'block';
            
            // è¨­å®šè§’è‰²è¦–è§’
            switchRole(currentRole);
            
            // ç”Ÿæˆåˆå§‹ç•Œé¢
            updateTermsDisplay();
            updateStrategyTip();
            updateScoreDisplay();
            
            // å•Ÿç”¨å ±å‘Šç”ŸæˆæŒ‰éˆ•
            document.getElementById('generate-report').disabled = false;
            
            // æ·»åŠ æ­¡è¿è¨Šæ¯
            addWelcomeMessage();
            
            // åˆå§‹å°ˆå®¶å»ºè­°
            updateExpertAdvice('opening');
        }
        
        function initializeTerms() {
            const initialBudget = document.getElementById('initialBudget').value || 100;
            
            currentTerms = {};
            if (selectedItems.includes('price')) {
                currentTerms.price = `${initialBudget} è¬å…ƒ`;
            }
            if (selectedItems.includes('quantity')) {
                currentTerms.quantity = 'å¾…å®š';
            }
            if (selectedItems.includes('payment')) {
                currentTerms.payment = 'æœˆçµ 30 å¤©';
            }
            if (selectedItems.includes('delivery')) {
                currentTerms.delivery = 'æ¨™æº–äº¤æœŸ 4 é€±';
            }
            if (selectedItems.includes('quality')) {
                currentTerms.quality = 'ä¸€èˆ¬å“è³ªæ¨™æº–';
            }
            if (selectedItems.includes('warranty')) {
                currentTerms.warranty = 'æ¨™æº–ä¿å›º 12 å€‹æœˆ';
            }
            if (selectedItems.includes('volume')) {
                currentTerms.volume = 'ç„¡æ‰¿è«¾';
            }
            if (selectedItems.includes('exclusivity')) {
                currentTerms.exclusivity = 'éå°ˆå±¬';
            }
        }
        
        function addWelcomeMessage() {
            const industry = document.getElementById('industry').value;
            const template = industryTemplates[industry];
            
            const welcomeMessage = `
                æ­¡è¿ä¾†åˆ°${template.name}çš„å”å•†å ´æ™¯ï¼${template.scenarios[currentRole]}
                
                æˆ‘æ˜¯${currentRole === 'buyer' ? 'ä¾›æ‡‰å•†' : 'æ¡è³¼æ–¹'}ä»£è¡¨ï¼Œå¾ˆé«˜èˆˆèˆ‡æ‚¨åˆä½œã€‚
                
                ä»Šå¤©æˆ‘å€‘å°‡å°±ä»¥ä¸‹é …ç›®é€²è¡Œå”å•†ï¼š${selectedItems.map(item => getItemLabel(item)).join('ã€')}
                
                æˆ‘å€‘æœŸå¾…èˆ‡æ‚¨å»ºç«‹è‰¯å¥½çš„åˆä½œé—œä¿‚ã€‚è«‹æå‡ºæ‚¨çš„åˆå§‹ææ¡ˆï¼Œæˆ‘æœƒèªçœŸè€ƒæ…®ä¸¦çµ¦äºˆå›æ‡‰ã€‚
            `;
            
            addMessage('ai', welcomeMessage, 1);
        }
        
        function switchRole(role) {
            currentRole = role;
            
            // æ›´æ–°æŒ‰éˆ•ç‹€æ…‹
            document.getElementById('buyer-view').classList.toggle('active', role === 'buyer');
            document.getElementById('supplier-view').classList.toggle('active', role === 'supplier');
            
            updateStrategyTip();
        }
        
        function updateTermsDisplay() {
            const termsContainer = document.getElementById('terms-display');
            termsContainer.innerHTML = '';
            
            const termLabels = {
                price: 'ğŸ’° åƒ¹æ ¼',
                quantity: 'ğŸ“¦ æ•¸é‡',
                payment: 'ğŸ’³ ä»˜æ¬¾æ¢ä»¶',
                delivery: 'ğŸšš äº¤æœŸ',
                quality: 'â­ å“è³ªæ¨™æº–',
                warranty: 'ğŸ›¡ï¸ ä¿å›ºæœå‹™',
                volume: 'ğŸ“ˆ æœªä¾†åˆä½œé‡',
                exclusivity: 'ğŸ¤ åˆä½œæ¨¡å¼'
            };
            
            Object.keys(currentTerms).forEach(key => {
                const termDiv = document.createElement('div');
                termDiv.className = 'term-item';
                termDiv.innerHTML = `
                    <div class="term-label">${termLabels[key]}</div>
                    <div class="term-value">${currentTerms[key]}</div>
                `;
                termsContainer.appendChild(termDiv);
            });
        }
        
        function addQuickText(type) {
            const messageInput = document.getElementById('messageInput');
            const templates = {
                'åƒ¹æ ¼èª¿æ•´': 'é—œæ–¼åƒ¹æ ¼éƒ¨åˆ†ï¼Œè€ƒæ…®åˆ°å¸‚å ´æƒ…æ³ï¼Œæˆ‘å€‘å¸Œæœ›èƒ½èª¿æ•´åˆ° [é‡‘é¡]ï¼Œ',
                'ä»˜æ¬¾æ¢ä»¶': 'ä»˜æ¬¾æ¢ä»¶æ–¹é¢ï¼ŒåŸºæ–¼ç¾é‡‘æµè€ƒé‡ï¼Œæˆ‘å€‘å»ºè­° [æ¢ä»¶]ï¼Œ',
                'äº¤æœŸè¦æ±‚': 'äº¤æœŸä¸Šæˆ‘å€‘çš„å¯¦éš›éœ€æ±‚æ˜¯ [æ™‚é–“]ï¼Œ',
                'æ•¸é‡æ‰¿è«¾': 'æˆ‘å€‘é¡˜æ„æ‰¿è«¾ [æ•¸é‡] çš„æ¡è³¼é‡ï¼Œä»¥ç²å¾—æ›´å¥½çš„æ¢ä»¶ï¼Œ',
                'å“è³ªä¿è­‰': 'å“è³ªæ¨™æº–å°æˆ‘å€‘å¾ˆé‡è¦ï¼Œæˆ‘å€‘éœ€è¦ [æ¨™æº–] çš„ä¿è­‰ï¼Œ',
                'é•·æœŸåˆä½œ': 'ç‚ºäº†å»ºç«‹é•·æœŸæˆ°ç•¥å¤¥ä¼´é—œä¿‚ï¼Œæˆ‘å€‘å»ºè­° [åˆä½œæ¨¡å¼]ï¼Œ'
            };
            
            const currentText = messageInput.value;
            const newText = currentText + (currentText ? ' ' : '') + templates[type];
            messageInput.value = newText;
            messageInput.focus();
        }
        
        function sendMessage() {
            const messageInput = document.getElementById('messageInput');
            const message = messageInput.value.trim();
            
            if (!message) {
                alert('è«‹è¼¸å…¥æ‚¨çš„å”å•†ææ¡ˆï¼');
                return;
            }
            
            if (currentRound > maxRounds) {
                alert('å”å•†å·²çµæŸï¼');
                return;
            }
            
            // æ·»åŠ ç”¨æˆ¶è¨Šæ¯
            addMessage('user', message, currentRound);
            
            // åˆ†æç”¨æˆ¶ææ¡ˆä¸¦è©•åˆ†
            const analysis = analyzeUserProposal(message);
            lastOffer = analysis.extractedTerms;
            
            // æ›´æ–°è©•åˆ†
            updateScores(analysis);
            
            // è¨˜éŒ„å­¸ç¿’æ•¸æ“š
            learningData.rounds.push({
                round: currentRound,
                userMessage: message,
                analysis: analysis,
                scores: {...scores}
            });
            
            // æ¸…ç©ºè¼¸å…¥
            messageInput.value = '';
            
            // æª¢æŸ¥æ˜¯å¦è§¸ç™¼çªç™¼äº‹ä»¶
            triggerCriticalEvent();
            
            // ç”ŸæˆAIå›æ‡‰
            setTimeout(() => {
                const aiResponse = generateEnhancedResponse(analysis);
                addMessage('ai', aiResponse, currentRound);
                
                // æ›´æ–°æ¢ä»¶
                updateTermsFromAnalysis(analysis);
                updateTermsDisplay();
                
                // æ›´æ–°å°ˆå®¶å»ºè­°
                const phase = currentRound <= 2 ? 'opening' : currentRound <= 4 ? 'midgame' : 'closing';
                updateExpertAdvice(phase);
                
                // æº–å‚™ä¸‹ä¸€è¼ª
                currentRound++;
                if (currentRound <= maxRounds) {
                    document.getElementById('current-round').textContent = `ç¬¬ ${currentRound} è¼ª`;
                    updateStrategyTip();
                } else {
                    // å”å•†çµæŸ
                    showNegotiationSummary();
                    analyzeFinalStyle();
                }
            }, 1500);
        }
        
        function analyzeUserProposal(message) {
            const analysis = {
                extractedTerms: {},
                priceChange: null,
                mainRequests: [],
                reasoning: [],
                communicationStyle: 'neutral',
                strategyUsed: [],
                complexityScore: 0,
                elementsCovered: []
            };
            
            // åƒ¹æ ¼åˆ†æ
            const priceMatch = message.match(/(\d+)(?:\.\d+)?è¬?å…ƒ?/);
            if (priceMatch) {
                analysis.extractedTerms.price = `${priceMatch[1]} è¬å…ƒ`;
                analysis.priceChange = parseInt(priceMatch[1]);
                analysis.elementsCovered.push('price');
            }
            
            // æ›´å…¨é¢çš„æ¢ä»¶åˆ†æ
            selectedItems.forEach(item => {
                if (item === 'payment' && (message.includes('ä»˜æ¬¾') || message.includes('æœˆçµ'))) {
                    analysis.extractedTerms.payment = 'èª¿æ•´ä»˜æ¬¾æ¢ä»¶';
                    analysis.elementsCovered.push('payment');
                }
                
                if (item === 'delivery' && (message.includes('äº¤æœŸ') || message.includes('é€±') || message.includes('å¤©'))) {
                    analysis.extractedTerms.delivery = 'èª¿æ•´äº¤æœŸè¦æ±‚';
                    analysis.elementsCovered.push('delivery');
                }
                
                if (item === 'quantity' && (message.includes('æ•¸é‡') || message.includes('è¬å€‹') || message.includes('æ¡è³¼é‡'))) {
                    analysis.extractedTerms.quantity = 'èª¿æ•´æ•¸é‡æ‰¿è«¾';
                    analysis.elementsCovered.push('quantity');
                }
                
                if (item === 'quality' && (message.includes('å“è³ª') || message.includes('æ¨™æº–') || message.includes('è¦æ ¼'))) {
                    analysis.extractedTerms.quality = 'æå‡å“è³ªè¦æ±‚';
                    analysis.elementsCovered.push('quality');
                }
                
                if (item === 'warranty' && (message.includes('ä¿å›º') || message.includes('ç¶­ä¿®') || message.includes('æœå‹™'))) {
                    analysis.extractedTerms.warranty = 'å»¶é•·ä¿å›ºæœå‹™';
                    analysis.elementsCovered.push('warranty');
                }
                
                if (item === 'volume' && (message.includes('æœªä¾†') || message.includes('é•·æœŸ') || message.includes('åˆä½œé‡'))) {
                    analysis.extractedTerms.volume = 'é•·æœŸåˆä½œæ‰¿è«¾';
                    analysis.elementsCovered.push('volume');
                }
                
                if (item === 'exclusivity' && (message.includes('å°ˆå±¬') || message.includes('ç¨å®¶') || message.includes('æˆ°ç•¥'))) {
                    analysis.extractedTerms.exclusivity = 'æˆ°ç•¥åˆä½œé—œä¿‚';
                    analysis.elementsCovered.push('exclusivity');
                }
            });
            
            // æºé€šé¢¨æ ¼åˆ†æ
            if (message.includes('å¸Œæœ›') || message.includes('å»ºè­°') || message.includes('è€ƒæ…®')) {
                analysis.communicationStyle = 'collaborative';
            } else if (message.includes('éœ€è¦') || message.includes('è¦æ±‚') || message.includes('å¿…é ˆ')) {
                analysis.communicationStyle = 'assertive';
            }
            
            // ç­–ç•¥åˆ†æ
            if (message.includes('äº¤æ›') || message.includes('ä½œç‚º') || message.includes('å¦‚æœ')) {
                analysis.strategyUsed.push('conditional_exchange');
            }
            if (message.includes('é•·æœŸ') || message.includes('æœªä¾†') || message.includes('åˆä½œ')) {
                analysis.strategyUsed.push('relationship_building');
            }
            if (message.includes('å¸‚å ´') || message.includes('ç«¶çˆ­') || message.includes('å…¶ä»–')) {
                analysis.strategyUsed.push('market_reference');
            }
            if (analysis.elementsCovered.length > 2) {
                analysis.strategyUsed.push('multi_element_negotiation');
            }
            
            // è¤‡é›œåº¦è©•åˆ†
            analysis.complexityScore = analysis.elementsCovered.length * 25 + 
                                     analysis.strategyUsed.length * 15 + 
                                     (message.length > 100 ? 20 : 0);
            
            return analysis;
        }
        
        function generateEnhancedResponse(analysis) {
            const industry = document.getElementById('industry').value;
            const oppositeRole = currentRole === 'buyer' ? 'supplier' : 'buyer';
            const aiPersonality = industryTemplates[industry].aiPersonality[oppositeRole];
            
            let response = "æ„Ÿè¬æ‚¨çš„è©³ç´°ææ¡ˆï¼Œè®“æˆ‘é€é …åˆ†ææ‚¨çš„æ¢ä»¶ï¼š\n\n";
            
            // æ ¹æ“šAIæ‡‰è©²é—œæ³¨çš„è¦ç´ é€²è¡Œå›æ‡‰
            const aiElements = aiPersonality.negotiationElements;
            const agreements = [];
            const disagreements = [];
            const negotiations = [];
            const newProposals = [];
            
            // åˆ†æç”¨æˆ¶æå‡ºçš„æ¢ä»¶
            Object.keys(analysis.extractedTerms).forEach(key => {
                const decision = makeSmartDecision(key, analysis.extractedTerms[key], aiPersonality);
                const item = getItemLabel(key);
                
                if (decision === 'agree') {
                    agreements.push(`${item}: ${analysis.extractedTerms[key]}`);
                } else if (decision === 'disagree') {
                    disagreements.push(`${item}: ${analysis.extractedTerms[key]}`);
                } else {
                    negotiations.push(`${item}: ${analysis.extractedTerms[key]}`);
                }
            });
            
            // AIä¸»å‹•æå‡ºå…¶å„ªå…ˆè¦ç´ 
            aiElements.forEach(element => {
                if (!analysis.elementsCovered.includes(element) && selectedItems.includes(element)) {
                    newProposals.push(element);
                }
            });
            
            // æ§‹å»ºè©³ç´°å›æ‡‰
            if (agreements.length > 0) {
                response += "âœ… **å¯ä»¥æ¥å—çš„æ¢ä»¶ï¼š**\n";
                agreements.forEach(item => {
                    response += `â€¢ ${item} - é€™å€‹æ¢ä»¶æˆ‘å€‘èªç‚ºæ˜¯åˆç†çš„\n`;
                });
                response += "\n";
            }
            
            if (disagreements.length > 0) {
                response += "âŒ **éœ€è¦èª¿æ•´çš„æ¢ä»¶ï¼š**\n";
                disagreements.forEach(item => {
                    response += `â€¢ ${item} - é€™å€‹æ¢ä»¶å°æˆ‘å€‘æœ‰æŒ‘æˆ°\n`;
                });
                response += "\n";
            }
            
            if (negotiations.length > 0) {
                response += "ğŸ”„ **å¯ä»¥å”å•†çš„æ¢ä»¶ï¼š**\n";
                negotiations.forEach(item => {
                    response += `â€¢ ${item} - é€™å€‹é …ç›®æˆ‘å€‘å¯ä»¥é€²ä¸€æ­¥è¨è«–\n`;
                });
                response += "\n";
            }
            
            // AIä¸»å‹•æå‡ºæ–°è¦ç´ 
            if (newProposals.length > 0) {
                response += "ğŸ’¡ **æˆ‘å€‘å¸Œæœ›è¨è«–çš„å…¶ä»–è¦ç´ ï¼š**\n";
                newProposals.forEach(element => {
                    const suggestion = generateElementProposal(element, aiPersonality);
                    response += `â€¢ ${getItemLabel(element)}: ${suggestion}\n`;
                });
                response += "\n";
            }
            
            // æ ¹æ“šå”å•†é€²åº¦å’Œäº‹ä»¶èª¿æ•´ç­–ç•¥
            if (eventTriggered) {
                response += "è€ƒæ…®åˆ°å‰›æ‰çš„çªç™¼æƒ…æ³ï¼Œæˆ‘å€‘éœ€è¦åœ¨è«‡åˆ¤ä¸­æ›´åŠ å‹™å¯¦å’Œéˆæ´»ã€‚";
            } else if (currentRound >= 3) {
                response += "æˆ‘å€‘å·²ç¶“è¨è«–äº†å¹¾è¼ªï¼Œå¸Œæœ›èƒ½å„˜å¿«æ‰¾åˆ°é›™æ–¹éƒ½æ»¿æ„çš„è§£æ±ºæ–¹æ¡ˆã€‚";
            }
            
            return response;
        }
        
        function makeSmartDecision(item, value, aiPersonality) {
            const isPriority = aiPersonality.priorities.includes(getItemLabel(item));
            const randomFactor = Math.random();
            
            if (item === 'price') {
                const currentPrice = parseFloat(currentTerms.price);
                const proposedPrice = parseFloat(value);
                const targetPrice = currentPrice * aiPersonality.priceRange;
                
                const priceGap = Math.abs(proposedPrice - targetPrice) / currentPrice;
                
                if (priceGap < 0.05) {
                    return 'agree';
                } else if (priceGap < 0.15) {
                    return 'negotiate';
                } else {
                    return 'disagree';
                }
            }
            
            // å°æ–¼å„ªå…ˆè¦ç´ æ›´åš´æ ¼
            if (isPriority) {
                return randomFactor > 0.4 ? 'negotiate' : 'agree';
            } else {
                return randomFactor > 0.7 ? 'agree' : 'negotiate';
            }
        }
        
        function generateElementProposal(element, aiPersonality) {
            const proposals = {
                payment: 'æˆ‘å€‘å¸Œæœ›èƒ½ç¸®çŸ­ä»˜æ¬¾é€±æœŸåˆ°15å¤©',
                delivery: 'æˆ‘å€‘èƒ½æä¾›åŠ æ€¥æœå‹™ï¼Œä½†éœ€è¦ç›¸æ‡‰çš„æ¢ä»¶èª¿æ•´',
                quantity: 'å¦‚æœèƒ½ç¢ºä¿æœ€å°è¨‚è³¼é‡ï¼Œæˆ‘å€‘å¯ä»¥æä¾›æ›´å¥½çš„åƒ¹æ ¼',
                quality: 'æˆ‘å€‘å»ºè­°æå‡åˆ°é«˜å“è³ªæ¨™æº–ï¼Œç¢ºä¿é•·æœŸåˆä½œé †åˆ©',
                warranty: 'æˆ‘å€‘é¡˜æ„æä¾›å»¶é•·ä¿å›ºï¼Œä»¥å»ºç«‹æ‚¨çš„ä¿¡å¿ƒ',
                volume: 'å¸Œæœ›èƒ½è¨è«–å¹´åº¦æ¡è³¼é‡ï¼Œä»¥ä¾¿æˆ‘å€‘å®‰æ’ç”¢èƒ½',
                exclusivity: 'è€ƒæ…®å»ºç«‹æˆ°ç•¥å¤¥ä¼´é—œä¿‚ï¼Œäº’æƒ äº’åˆ©'
            };
            
            return proposals[element] || 'æˆ‘å€‘å¸Œæœ›åœ¨é€™å€‹æ–¹é¢é€²è¡Œè¨è«–';
        }
        
        function triggerCriticalEvent() {
            const intensity = document.getElementById('eventIntensity').value;
            if (intensity === 'none' || eventTriggered) return;
            
            const eventChance = { low: 30, medium: 50, high: 70 }[intensity];
            if (Math.random() * 100 < eventChance) {
                const availableEvents = criticalEvents[intensity].filter(e => e.trigger <= currentRound);
                if (availableEvents.length > 0) {
                    const event = availableEvents[Math.floor(Math.random() * availableEvents.length)];
                    showCriticalEvent(event);
                    eventTriggered = true;
                }
            }
        }
        
        function showCriticalEvent(event) {
            document.getElementById('event-notification').classList.remove('hidden');
            document.getElementById('event-text').textContent = event.message;
            
            // æ·»åŠ äº‹ä»¶è¨Šæ¯åˆ°å°è©±
            addMessage('event', `ğŸš¨ çªç™¼äº‹ä»¶ï¼š${event.message}`, currentRound);
            
            // æ‡‰ç”¨äº‹ä»¶å½±éŸ¿
            if (event.priceAdjustment && currentTerms.price) {
                const currentPrice = parseFloat(currentTerms.price);
                const newPrice = Math.round(currentPrice * event.priceAdjustment);
                currentTerms.price = `${newPrice} è¬å…ƒ`;
                updateTermsDisplay();
            }
            
            // æ›´æ–°å°ˆå®¶å»ºè­°
            updateExpertAdvice('crisis', event);
        }
        
        function updateScores(analysis) {
            // æ›´æ™ºèƒ½çš„è©•åˆ†ç³»çµ±
            let communicationScore = 50;
            if (analysis.communicationStyle === 'collaborative') communicationScore += 25;
            if (analysis.communicationStyle === 'assertive') communicationScore += 15;
            if (analysis.reasoning.length > 0) communicationScore += 15;
            
            let strategyScore = 40 + (analysis.strategyUsed.length * 20);
            if (analysis.strategyUsed.includes('multi_element_negotiation')) strategyScore += 15;
            if (analysis.strategyUsed.includes('conditional_exchange')) strategyScore += 10;
            
            let exchangeScore = analysis.elementsCovered.length * 20;
            if (analysis.elementsCovered.length >= 3) exchangeScore += 20;
            
            let resultScore = 60;
            if (batnaSettings.value === 'excellent') resultScore += 20;
            else if (batnaSettings.value === 'good') resultScore += 15;
            else if (batnaSettings.value === 'fair') resultScore += 10;
            
            // å¹³æ»‘æ›´æ–°åˆ†æ•¸
            scores.communication = Math.min(Math.round((scores.communication * 0.3 + communicationScore * 0.7)), 100);
            scores.strategy = Math.min(Math.round((scores.strategy * 0.3 + strategyScore * 0.7)), 100);
            scores.exchange = Math.min(Math.round((scores.exchange * 0.3 + exchangeScore * 0.7)), 100);
            scores.result = Math.min(Math.round((scores.result * 0.3 + resultScore * 0.7)), 100);
            scores.overall = Math.round((scores.communication + scores.strategy + scores.exchange + scores.result) / 4);
            
            updateScoreDisplay();
        }
        
        function updateScoreDisplay() {
            document.getElementById('overall-score').textContent = scores.overall;
            document.getElementById('communication-score').textContent = scores.communication;
            document.getElementById('strategy-score').textContent = scores.strategy;
            document.getElementById('exchange-score').textContent = scores.exchange;
            document.getElementById('result-score').textContent = scores.result;
            
            document.getElementById('communication-bar').style.width = scores.communication + '%';
            document.getElementById('strategy-bar').style.width = scores.strategy + '%';
            document.getElementById('exchange-bar').style.width = scores.exchange + '%';
            document.getElementById('result-bar').style.width = scores.result + '%';
            document.getElementById('current-progress').style.width = scores.overall + '%';
            document.getElementById('current-value').textContent = scores.overall;
        }
        
        function updateExpertAdvice(phase, event = null) {
            const expertElement = document.getElementById('expert-text');
            let advice = '';
            
            if (phase === 'crisis' && event) {
                advice = `é¢å°çªç™¼äº‹ä»¶ï¼šã€Œ${event.message}ã€ï¼Œå»ºè­°æ‚¨ï¼š1) ä¿æŒå†·éœï¼Œé‡æ–°è©•ä¼°ç­–ç•¥ 2) å°‹æ‰¾æ–°çš„åƒ¹å€¼å‰µé€ æ©Ÿæœƒ 3) è€ƒæ…®èª¿æ•´æ‚¨çš„BATNAè©•ä¼°ã€‚é€™å¯èƒ½æ˜¯è«‡åˆ¤çš„è½‰æŠ˜é»ã€‚`;
            } else if (phase === 'opening') {
                advice = `è«‡åˆ¤é–‹å§‹éšæ®µï¼Œå»ºè­°å…ˆå»ºç«‹è‰¯å¥½é—œä¿‚ï¼Œå±•ç¾å°ˆæ¥­æ…‹åº¦ã€‚æ ¹æ“šæ‚¨çš„BATNAå¼·åº¦ï¼ˆ${batnaSettings.value === 'excellent' ? 'å„ªç§€' : batnaSettings.value === 'good' ? 'è‰¯å¥½' : batnaSettings.value === 'fair' ? 'æ™®é€š' : 'è¼ƒå·®'}ï¼‰ï¼Œ${batnaSettings.value === 'excellent' || batnaSettings.value === 'good' ? 'æ‚¨å¯ä»¥è¼ƒæœ‰ä¿¡å¿ƒåœ°é€²è¡Œè«‡åˆ¤' : 'å»ºè­°æ¡ç”¨æ›´å¤šåˆä½œæ€§ç­–ç•¥'}ã€‚`;
            } else if (phase === 'midgame') {
                advice = `ä¸­æœŸè«‡åˆ¤éšæ®µï¼Œç¾åœ¨æ˜¯å±•ç¾ç­–ç•¥çš„æ™‚å€™ã€‚${scores.exchange < 70 ? 'å˜—è©¦æå‡ºæ›´å¤šè¦ç´ çš„çµ„åˆäº¤æ›ï¼Œä¸è¦åªå°ˆæ³¨æ–¼å–®ä¸€æ¢ä»¶' : 'ç¹¼çºŒä¿æŒå¤šå…ƒåŒ–è«‡åˆ¤ç­–ç•¥ï¼Œæ‚¨åœ¨æ¢ä»¶äº¤æ›æ–¹é¢è¡¨ç¾ä¸éŒ¯'}ã€‚`;
            } else if (phase === 'closing') {
                advice = 'æ¥è¿‘å°¾è²æ™‚ï¼Œå°ˆæ³¨æ–¼é›™æ–¹éƒ½èƒ½æ¥å—çš„æœ€çµ‚æ–¹æ¡ˆã€‚å›é¡§æ‚¨çš„BATNAåƒ¹å€¼ï¼Œç¢ºä¿æœ€çµ‚å”è­°å„ªæ–¼æ‚¨çš„æ›¿ä»£é¸æ“‡ã€‚';
            } else {
                advice = 'æº–å‚™é–‹å§‹å”å•†ã€‚è¨˜ä½ï¼šæ‚¨çš„BATNAæ˜¯è«‡åˆ¤çš„é‡è¦å¾Œç›¾ï¼Œä½†å°æ–¹ä¸¦ä¸çŸ¥é“æ‚¨çš„åº•ç‰Œã€‚';
            }
            
            if (scores.communication < 70 && phase !== 'preparation') {
                advice += " ğŸ’¬ å»ºè­°ä½¿ç”¨æ›´å¤šå”ä½œæ€§èªè¨€ï¼Œå¦‚'æˆ‘å€‘ä¸€èµ·ä¾†çœ‹çœ‹å¦‚ä½•è§£æ±ºé€™å€‹å•é¡Œ'ã€‚";
            }
            if (scores.strategy < 60 && phase !== 'preparation') {
                advice += " ğŸ² å˜—è©¦é‹ç”¨æ›´å¤šè«‡åˆ¤ç­–ç•¥ï¼Œå¦‚æ¢ä»¶äº¤æ›æˆ–é•·æœŸåˆä½œåƒ¹å€¼è«–è­‰ã€‚";
            }
            
            expertElement.textContent = advice;
        }
        
        function updateTermsFromAnalysis(analysis) {
            Object.keys(analysis.extractedTerms).forEach(key => {
                const acceptanceRate = eventTriggered ? 0.3 : 0.6;
                if (Math.random() > acceptanceRate) {
                    currentTerms[key] = analysis.extractedTerms[key];
                }
            });
        }
        
        function addMessage(sender, content, round) {
            const conversation = document.getElementById('conversation');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${sender}`;
            
            let roleText = '';
            let avatar = '';
            
            if (sender === 'user') {
                roleText = currentRole === 'buyer' ? 'æ¡è³¼æ–¹' : 'ä¾›æ‡‰å•†';
                avatar = currentRole === 'buyer' ? 'ğŸ›’' : 'ğŸ­';
            } else if (sender === 'ai') {
                roleText = currentRole === 'buyer' ? 'ä¾›æ‡‰å•†' : 'æ¡è³¼æ–¹';
                avatar = currentRole === 'buyer' ? 'ğŸ­' : 'ğŸ›’';
            } else if (sender === 'expert') {
                roleText = 'å°ˆå®¶';
                avatar = 'ğŸ“';
            } else if (sender === 'event') {
                roleText = 'çªç™¼äº‹ä»¶';
                avatar = 'ğŸ“¢';
            }
            
            messageDiv.innerHTML = `
                <div class="message-avatar">${avatar}</div>
                <div class="message-content">
                    <div class="message-header">
                        <span>${roleText}</span>
                        <span>ç¬¬${round}è¼ª</span>
                    </div>
                    ${content.replace(/\n/g, '<br>').replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')}
                </div>
            `;
            
            conversation.appendChild(messageDiv);
            conversation.scrollTop = conversation.scrollHeight;
        }
        
        function analyzeFinalStyle() {
            const strategies = learningData.rounds.flatMap(r => r.analysis.strategyUsed);
            const avgComplexity = learningData.rounds.reduce((sum, r) => sum + r.analysis.complexityScore, 0) / learningData.rounds.length;
            const elementsUsed = new Set(learningData.rounds.flatMap(r => r.analysis.elementsCovered));
            
            let style = '';
            if (strategies.includes('multi_element_negotiation') && elementsUsed.size > 4) {
                style = 'å…¨æ–¹ä½ç­–ç•¥å®¶ - å–„æ–¼é‹ç”¨å¤šå…ƒè¦ç´ å‰µé€ åƒ¹å€¼';
            } else if (strategies.includes('conditional_exchange') && avgComplexity > 60) {
                style = 'æ¢ä»¶äº¤æ›å°ˆå®¶ - ç²¾æ–¼è¤‡é›œè«‡åˆ¤ç­–ç•¥';
            } else if (strategies.includes('relationship_building')) {
                style = 'é—œä¿‚å»ºæ§‹è€… - é‡è¦–é•·æœŸåˆä½œåƒ¹å€¼';
            } else if (avgComplexity < 40) {
                style = 'ç›´æ¥æºé€šè€… - å‚¾å‘ç°¡æ½”æœ‰æ•ˆçš„è«‡åˆ¤';
            } else {
                style = 'å¹³è¡¡å”èª¿è€… - èƒ½éˆæ´»é‹ç”¨ä¸åŒç­–ç•¥';
            }
            
            learningData.style = style;
            document.getElementById('negotiation-style').innerHTML = `<strong>${style}</strong><br><small>åŸºæ–¼${learningData.rounds.length}è¼ªå”å•†çš„æ·±åº¦åˆ†æ</small>`;
        }
        
        function showNegotiationSummary() {
            setTimeout(() => {
                const effectivenesScore = calculateNegotiationEffectiveness();
                
                const summaryMessage = `
                    ğŸ‰ å”å•†å®Œæˆï¼æ­å–œæ‚¨å®Œæˆäº†å°ˆæ¥­ç´šè«‡åˆ¤è¨“ç·´ï¼
                    
                    **ğŸ“Š æœ€çµ‚çµæœåˆ†æï¼š**
                    ${Object.keys(currentTerms).map(key => 
                        `â€¢ ${getItemLabel(key)}: ${currentTerms[key]}`
                    ).join('\n')}
                    
                    **ğŸ† æ‚¨çš„æœ€çµ‚è©•åˆ†ï¼š${scores.overall}/100**
                    **ğŸ“ˆ è«‡åˆ¤æ•ˆæœï¼š${effectivenesScore >= 80 ? 'éå¸¸æˆåŠŸ' : effectivenesScore >= 70 ? 'æˆåŠŸ' : effectivenesScore >= 60 ? 'é”æ¨™' : 'æœ‰æ”¹é€²ç©ºé–“'}**
                    
                    **ğŸ“ å­¸ç¿’æˆæœçµ±è¨ˆï¼š**
                    âœ“ å®Œæˆäº† ${maxRounds} è¼ªå°ˆæ¥­å”å•†æµç¨‹
                    âœ“ é‹ç”¨äº† ${selectedItems.length} ç¨®å”å•†è¦ç´ 
                    âœ“ å­¸æœƒäº†å¤šå…ƒæ¢ä»¶äº¤æ›æŠ€å·§
                    âœ“ æŒæ¡äº†BATNAé‹ç”¨ç­–ç•¥
                    ${eventTriggered ? 'âœ“ æˆåŠŸæ‡‰å°çªç™¼äº‹ä»¶æŒ‘æˆ°' : ''}
                    
                    é»æ“Šå³å´ã€Œç”Ÿæˆå­¸ç¿’å ±å‘Šã€ç²å¾—å®Œæ•´åˆ†æï¼
                `;
                
                addMessage('ai', summaryMessage, maxRounds);
            }, 1000);
        }
        
        function calculateNegotiationEffectiveness() {
            let effectiveness = scores.overall;
            
            if (batnaSettings.value === 'excellent') {
                effectiveness += 5;
            }
            
            if (eventTriggered) {
                effectiveness += 8;
            }
            
            const elementsUsed = new Set(learningData.rounds.flatMap(r => r.analysis.elementsCovered));
            if (elementsUsed.size >= 4) {
                effectiveness += 5;
            }
            
            return Math.min(effectiveness, 100);
        }
        
        function generateLearningReport() {
            // è¨ˆç®—è©³ç´°çš„è©•åˆ†é‚è¼¯
            const totalRounds = learningData.rounds.length;
            const avgElementsUsed = totalRounds > 0 ? 
                learningData.rounds.reduce((sum, r) => sum + r.analysis.elementsCovered.length, 0) / totalRounds : 0;
            const totalStrategies = new Set(learningData.rounds.flatMap(r => r.analysis.strategyUsed)).size;
            const avgComplexity = totalRounds > 0 ? 
                learningData.rounds.reduce((sum, r) => sum + r.analysis.complexityScore, 0) / totalRounds : 0;
            
            // æºé€šé¢¨æ ¼åˆ†æ
            const communicationStyles = learningData.rounds.map(r => r.analysis.communicationStyle);
            const collaborativeCount = communicationStyles.filter(s => s === 'collaborative').length;
            const assertiveCount = communicationStyles.filter(s => s === 'assertive').length;
            
            const report = `
                # å€‹äººåŒ–è«‡åˆ¤å­¸ç¿’å ±å‘Š
                
                ## ğŸ¯ å”å•†è¡¨ç¾æ‘˜è¦
                - **ç¸½é«”è©•åˆ†**ï¼š${scores.overall}/100 ${scores.overall >= 80 ? '(å„ªç§€)' : scores.overall >= 70 ? '(è‰¯å¥½)' : scores.overall >= 60 ? '(åŠæ ¼)' : '(éœ€åŠ å¼·)'}
                - **æºé€šæŠ€å·§**ï¼š${scores.communication}/100
                - **ç­–ç•¥é‹ç”¨**ï¼š${scores.strategy}/100  
                - **æ¢ä»¶äº¤æ›**ï¼š${scores.exchange}/100
                - **çµæœé”æˆ**ï¼š${scores.result}/100
                
                ## ğŸ“Š è©³ç´°è©•åˆ†é‚è¼¯åˆ†æ
                
                ### ğŸ’¬ æºé€šæŠ€å·§è©•åˆ† (${scores.communication}/100)
                **è©•åˆ†ä¾æ“šï¼š**
                - åŸºç¤åˆ†ï¼š50åˆ†
                - å”ä½œæ€§æºé€šåŠ åˆ†ï¼š${collaborativeCount}æ¬¡ Ã— 25åˆ† = ${collaborativeCount * 25}åˆ†
                - å …å®šæ€§æºé€šåŠ åˆ†ï¼š${assertiveCount}æ¬¡ Ã— 15åˆ† = ${assertiveCount * 15}åˆ†
                - æœ‰ç†ç”±èªªæ˜çš„è¼ªæ¬¡ï¼š${learningData.rounds.filter(r => r.analysis.reasoning.length > 0).length}æ¬¡ Ã— 15åˆ†
                
                **åˆ†æèªªæ˜ï¼š**
                ${scores.communication >= 80 ? 'æ‚¨å±•ç¾å‡ºå„ªç§€çš„æºé€šæŠ€å·§ï¼Œå–„æ–¼ä½¿ç”¨å”ä½œæ€§èªè¨€å»ºç«‹è‰¯å¥½é—œä¿‚ã€‚' : 
                  scores.communication >= 70 ? 'æ‚¨çš„æºé€šæŠ€å·§è‰¯å¥½ï¼Œä½†å¯ä»¥æ›´å¤šé‹ç”¨å”ä½œæ€§è¡¨é”æ–¹å¼ã€‚' :
                  scores.communication >= 60 ? 'æ‚¨çš„æºé€šè¼ƒç‚ºç›´æ¥ï¼Œå»ºè­°å¢åŠ æ›´å¤šèªªæœæ€§å’Œå”ä½œæ€§å…ƒç´ ã€‚' :
                  'å»ºè­°åŠ å¼·æºé€šæŠ€å·§ï¼Œå¤šä½¿ç”¨ã€Œæˆ‘å€‘ä¸€èµ·ã€ã€Œå…±åŒã€ç­‰å”ä½œæ€§èªè¨€ã€‚'}
                
                ### ğŸ² ç­–ç•¥é‹ç”¨è©•åˆ† (${scores.strategy}/100)
                **è©•åˆ†ä¾æ“šï¼š**
                - åŸºç¤åˆ†ï¼š40åˆ†
                - ä½¿ç”¨ç­–ç•¥æ•¸é‡ï¼š${totalStrategies}ç¨® Ã— 20åˆ† = ${totalStrategies * 20}åˆ†
                - å¤šå…ƒè¦ç´ è«‡åˆ¤ï¼š${learningData.rounds.filter(r => r.analysis.strategyUsed.includes('multi_element_negotiation')).length}æ¬¡ Ã— 15åˆ†
                - æ¢ä»¶äº¤æ›ç­–ç•¥ï¼š${learningData.rounds.filter(r => r.analysis.strategyUsed.includes('conditional_exchange')).length}æ¬¡ Ã— 10åˆ†
                
                **åˆ†æèªªæ˜ï¼š**
                æ‚¨åœ¨${totalRounds}è¼ªå”å•†ä¸­é‹ç”¨äº†${totalStrategies}ç¨®ä¸åŒç­–ç•¥ï¼Œå¹³å‡æ¯è¼ªæ¶‰åŠ${avgElementsUsed.toFixed(1)}å€‹å”å•†è¦ç´ ã€‚
                ${scores.strategy >= 80 ? 'ç­–ç•¥é‹ç”¨éå¸¸å‡ºè‰²ï¼Œå–„æ–¼éˆæ´»èª¿æ•´è«‡åˆ¤æ–¹æ³•ã€‚' :
                  scores.strategy >= 70 ? 'ç­–ç•¥é‹ç”¨è‰¯å¥½ï¼Œä½†å¯ä»¥å˜—è©¦æ›´å¤šå‰µæ–°çš„è«‡åˆ¤æŠ€å·§ã€‚' :
                  scores.strategy >= 60 ? 'åŸºæœ¬ç­–ç•¥é‹ç”¨åˆæ ¼ï¼Œå»ºè­°å­¸ç¿’æ›´å¤šè«‡åˆ¤ç­–ç•¥ã€‚' :
                  'ç­–ç•¥é‹ç”¨éœ€è¦åŠ å¼·ï¼Œå»ºè­°å¤šå­¸ç¿’æ¢ä»¶äº¤æ›ã€å¸‚å ´åƒè€ƒç­‰æŠ€å·§ã€‚'}
                
                ### ğŸ”„ æ¢ä»¶äº¤æ›è©•åˆ† (${scores.exchange}/100)
                **è©•åˆ†ä¾æ“šï¼š**
                - å¹³å‡æ¯è¼ªä½¿ç”¨è¦ç´ ï¼š${avgElementsUsed.toFixed(1)}å€‹ Ã— 20åˆ† = ${Math.round(avgElementsUsed * 20)}åˆ†
                - å¤šå…ƒè¦ç´ çå‹µï¼š${avgElementsUsed >= 3 ? '20åˆ†ï¼ˆå„ªç§€ï¼‰' : '0åˆ†'}
                - è¤‡é›œåº¦ä¿‚æ•¸ï¼š${avgComplexity.toFixed(0)}åˆ†ï¼ˆåŸºæ–¼ææ¡ˆè¤‡é›œåº¦ï¼‰
                
                **åˆ†æèªªæ˜ï¼š**
                æ‚¨å¹³å‡æ¯è¼ªå”å•†æ¶‰åŠ${avgElementsUsed.toFixed(1)}å€‹ä¸åŒè¦ç´ ï¼Œé¡¯ç¤º${avgElementsUsed >= 3 ? 'å„ªç§€çš„' : avgElementsUsed >= 2 ? 'è‰¯å¥½çš„' : 'åŸºç¤çš„'}å¤šå…ƒè«‡åˆ¤èƒ½åŠ›ã€‚
                ${scores.exchange >= 80 ? 'æ‚¨ç²¾é€šæ¢ä»¶äº¤æ›ï¼Œèƒ½éˆæ´»é‹ç”¨å¤šç¨®è¦ç´ å‰µé€ åƒ¹å€¼ã€‚' :
                  scores.exchange >= 70 ? 'æ¢ä»¶äº¤æ›èƒ½åŠ›è‰¯å¥½ï¼Œå¯ä»¥å˜—è©¦æ›´è¤‡é›œçš„è¦ç´ çµ„åˆã€‚' :
                  scores.exchange >= 60 ? 'åŸºæœ¬æŒæ¡æ¢ä»¶äº¤æ›ï¼Œå»ºè­°ç·´ç¿’åŒæ™‚è«‡åˆ¤æ›´å¤šè¦ç´ ã€‚' :
                  'å»ºè­°åŠ å¼·æ¢ä»¶äº¤æ›æŠ€å·§ï¼Œä¸è¦åªå°ˆæ³¨æ–¼å–®ä¸€æ¢ä»¶ï¼ˆå¦‚åƒ¹æ ¼ï¼‰ã€‚'}
                
                ### ğŸ¯ çµæœé”æˆè©•åˆ† (${scores.result}/100)
                **è©•åˆ†ä¾æ“šï¼š**
                - åŸºç¤åˆ†ï¼š60åˆ†
                - BATNAå¼·åº¦åŠ åˆ†ï¼š${batnaSettings.value === 'excellent' ? '20åˆ†ï¼ˆå„ªç§€ï¼‰' : 
                                   batnaSettings.value === 'good' ? '15åˆ†ï¼ˆè‰¯å¥½ï¼‰' : 
                                   batnaSettings.value === 'fair' ? '10åˆ†ï¼ˆæ™®é€šï¼‰' : '0åˆ†ï¼ˆè¼ƒå·®ï¼‰'}
                - çªç™¼äº‹ä»¶æ‡‰å°ï¼š${eventTriggered ? '15åˆ†ï¼ˆæˆåŠŸæ‡‰å°ï¼‰' : '0åˆ†ï¼ˆç„¡äº‹ä»¶ï¼‰'}
                - è«‡åˆ¤å®Œæˆåº¦ï¼š${currentRound > maxRounds ? '10åˆ†ï¼ˆå®Œæ•´å®Œæˆï¼‰' : '5åˆ†ï¼ˆé€²è¡Œä¸­ï¼‰'}
                
                **åˆ†æèªªæ˜ï¼š**
                æ‚¨çš„BATNAè¨­å®šç‚ºã€Œ${batnaSettings.value === 'excellent' ? 'å„ªç§€' : batnaSettings.value === 'good' ? 'è‰¯å¥½' : batnaSettings.value === 'fair' ? 'æ™®é€š' : 'è¼ƒå·®'}ã€ç­‰ç´šï¼Œ
                ${batnaSettings.value === 'excellent' || batnaSettings.value === 'good' ? 
                  'é¡¯ç¤ºæ‚¨æœ‰è¼ƒå¼·çš„è«‡åˆ¤ç±Œç¢¼ï¼Œé€™æœ‰åŠ©æ–¼é”æˆæ›´å¥½çš„å”è­°ã€‚' :
                  'å»ºè­°åœ¨å¯¦éš›è«‡åˆ¤å‰åŸ¹é¤Šæ›´å¼·çš„æ›¿ä»£æ–¹æ¡ˆï¼Œå¢å¼·è«‡åˆ¤åœ°ä½ã€‚'}
                
                ## ğŸ§  è«‡åˆ¤é¢¨æ ¼åˆ†æ
                **æ‚¨çš„è«‡åˆ¤é¢¨æ ¼**ï¼š${learningData.style}
                
                **é¢¨æ ¼ç‰¹å¾µåˆ†æï¼š**
                - å”ä½œæ€§è¡¨é”ï¼š${collaborativeCount}/${totalRounds}è¼ª (${Math.round(collaborativeCount/totalRounds*100)}%)
                - å …å®šæ€§è¡¨é”ï¼š${assertiveCount}/${totalRounds}è¼ª (${Math.round(assertiveCount/totalRounds*100)}%)
                - å¹³å‡è«‡åˆ¤è¤‡é›œåº¦ï¼š${avgComplexity.toFixed(0)}åˆ†
                - ç­–ç•¥å¤šæ¨£æ€§ï¼š${totalStrategies}ç¨®ä¸åŒç­–ç•¥
                
                ## ğŸ”’ BATNAé‹ç”¨è©•ä¼°
                - **BATNAè¨­å®š**ï¼š${batnaSettings.option ? 'âœ… å·²å®Œæˆ' : 'âŒ æœªå®Œæˆ'}
                - **BATNAå¼·åº¦**ï¼š${batnaSettings.value === 'excellent' ? 'å„ªç§€ - æ‚¨æ¡æœ‰å¼·å¤§çš„æ›¿ä»£é¸æ“‡' : 
                                 batnaSettings.value === 'good' ? 'è‰¯å¥½ - æ‚¨æœ‰ä¸éŒ¯çš„å¾Œå‚™æ–¹æ¡ˆ' : 
                                 batnaSettings.value === 'fair' ? 'æ™®é€š - æ‚¨æœ‰åŸºæœ¬çš„æ›¿ä»£é¸æ“‡' : 
                                 'è¼ƒå·® - å»ºè­°åŠ å¼·æ›¿ä»£æ–¹æ¡ˆçš„æº–å‚™'}
                - **BATNAå½±éŸ¿**ï¼šå¼·åº¦${batnaSettings.value === 'excellent' || batnaSettings.value === 'good' ? 'å¢å¼·äº†æ‚¨çš„è«‡åˆ¤ä¿¡å¿ƒ' : 'é™åˆ¶äº†æ‚¨çš„è«‡åˆ¤ç©ºé–“'}
                
                ## ğŸ† ä¸»è¦å„ªå‹¢
                ${scores.communication >= 80 ? 'â€¢ ğŸ—£ï¸ å‡ºè‰²çš„æºé€šè¡¨é”èƒ½åŠ›ï¼Œå–„æ–¼å»ºç«‹å”ä½œé—œä¿‚' : ''}
                ${scores.strategy >= 80 ? 'â€¢ ğŸ¯ å„ªç§€çš„ç­–ç•¥æ€ç¶­ï¼Œèƒ½éˆæ´»é‹ç”¨å¤šç¨®è«‡åˆ¤æŠ€å·§' : ''}
                ${scores.exchange >= 80 ? 'â€¢ ğŸ”„ ç²¾é€šæ¢ä»¶äº¤æ›ï¼Œèƒ½åŒæ™‚è™•ç†å¤šå€‹è«‡åˆ¤è¦ç´ ' : ''}
                ${scores.result >= 80 ? 'â€¢ ğŸ¯ èƒ½æœ‰æ•ˆé”æˆè«‡åˆ¤ç›®æ¨™ï¼Œå……åˆ†åˆ©ç”¨BATNAå„ªå‹¢' : ''}
                ${avgElementsUsed >= 3 ? 'â€¢ ğŸŒŸ å–„æ–¼é‹ç”¨å¤šå…ƒè«‡åˆ¤è¦ç´ ï¼Œä¸å±€é™æ–¼å–®ä¸€æ¢ä»¶' : ''}
                ${totalStrategies >= 3 ? 'â€¢ ğŸ”§ ç­–ç•¥é‹ç”¨å¤šæ¨£åŒ–ï¼Œå±•ç¾éˆæ´»çš„è«‡åˆ¤æ€ç¶­' : ''}
                
                ## ğŸ“ˆ å…·é«”æ”¹é€²å»ºè­°
                ${scores.communication < 70 ? `â€¢ ğŸ’¬ **æºé€šæ”¹é€²**ï¼šç›®å‰${scores.communication}åˆ†ï¼Œå»ºè­°å¤šä½¿ç”¨ã€Œæˆ‘å€‘å¯ä»¥ä¸€èµ·...ã€ã€Œæ‚¨è¦ºå¾—...å¦‚ä½•ã€ç­‰å”ä½œæ€§èªè¨€` : ''}
                ${scores.strategy < 70 ? `â€¢ ğŸ² **ç­–ç•¥æå‡**ï¼šç›®å‰${scores.strategy}åˆ†ï¼Œå»ºè­°å­¸ç¿’æ›´å¤šè«‡åˆ¤ç­–ç•¥ï¼Œå¦‚å¸‚å ´åƒè€ƒã€æ™‚é–“å£“åŠ›é‹ç”¨ç­‰` : ''}
                ${scores.exchange < 70 ? `â€¢ ğŸ”€ **æ¢ä»¶äº¤æ›**ï¼šç›®å‰${scores.exchange}åˆ†ï¼Œå»ºè­°åŒæ™‚è«‡åˆ¤3å€‹ä»¥ä¸Šè¦ç´ ï¼Œç·´ç¿’è¤‡é›œçš„æ¢ä»¶çµ„åˆ` : ''}
                ${scores.result < 70 ? `â€¢ ğŸ¯ **çµæœé”æˆ**ï¼šç›®å‰${scores.result}åˆ†ï¼Œå»ºè­°åŠ å¼·BATNAæº–å‚™ï¼ŒåŸ¹é¤Šæ›´å¼·çš„æ›¿ä»£æ–¹æ¡ˆ` : ''}
                ${avgElementsUsed < 2 ? 'â€¢ ğŸ“Š **è¦ç´ é‹ç”¨**ï¼šå¹³å‡æ¯è¼ªåªç”¨äº†1-2å€‹è¦ç´ ï¼Œå»ºè­°å˜—è©¦åŒæ™‚è«‡åˆ¤æ›´å¤šæ¢ä»¶' : ''}
                ${totalStrategies < 2 ? 'â€¢ ğŸ”§ **ç­–ç•¥å¤šæ¨£æ€§**ï¼šåªä½¿ç”¨äº†å°‘æ•¸ç­–ç•¥ï¼Œå»ºè­°å­¸ç¿’æ¢ä»¶äº¤æ›ã€é—œä¿‚å»ºç«‹ç­‰æ›´å¤šæŠ€å·§' : ''}
                
                ## ğŸš€ ä¸‹æ¬¡è«‡åˆ¤è¡Œå‹•è¨ˆç•«
                
                ### çŸ­æœŸç›®æ¨™ï¼ˆä¸‹æ¬¡è«‡åˆ¤ï¼‰
                1. **${scores.communication < 70 ? 'æºé€šæŠ€å·§' : scores.strategy < 70 ? 'ç­–ç•¥é‹ç”¨' : scores.exchange < 70 ? 'æ¢ä»¶äº¤æ›' : 'ç¶œåˆæå‡'}é‡é»åŠ å¼·**
                2. **è‡³å°‘åŒæ™‚è«‡åˆ¤3å€‹ä»¥ä¸Šè¦ç´ **ï¼ˆç›®å‰å¹³å‡${avgElementsUsed.toFixed(1)}å€‹ï¼‰
                3. **å˜—è©¦æ–°ç­–ç•¥**ï¼š${totalStrategies < 3 ? 'å­¸ç¿’æ¢ä»¶äº¤æ›ã€å¸‚å ´åƒè€ƒæŠ€å·§' : 'æ·±åŒ–ç¾æœ‰ç­–ç•¥çš„é‹ç”¨'}
                
                ### ä¸­æœŸç›®æ¨™ï¼ˆ1-3å€‹æœˆï¼‰
                1. **BATNAå¼·åŒ–**ï¼š${batnaSettings.value === 'excellent' ? 'ä¿æŒç¾æœ‰å„ªå‹¢' : 'åŸ¹é¤Šæ›´å¼·çš„æ›¿ä»£æ–¹æ¡ˆé¸æ“‡'}
                2. **æƒ…å¢ƒç·´ç¿’**ï¼šå˜—è©¦ä¸åŒç”¢æ¥­ã€è¦æ¨¡çš„è«‡åˆ¤æƒ…å¢ƒ
                3. **çªç™¼äº‹ä»¶æ‡‰å°**ï¼š${eventTriggered ? 'ç¹¼çºŒæå‡å±æ©Ÿè™•ç†èƒ½åŠ›' : 'ç·´ç¿’é«˜å¼·åº¦çªç™¼äº‹ä»¶æŒ‘æˆ°'}
                
                ### é•·æœŸç›®æ¨™ï¼ˆ3-6å€‹æœˆï¼‰
                1. **æˆç‚ºè«‡åˆ¤å°ˆå®¶**ï¼šç›®æ¨™ç¸½é«”è©•åˆ†é”åˆ°85åˆ†ä»¥ä¸Š
                2. **æ•™å°ä»–äºº**ï¼šå°‡å­¸åˆ°çš„æŠ€å·§å‚³æˆçµ¦åŒäº‹æˆ–æœ‹å‹
                3. **å¯¦æˆ°æ‡‰ç”¨**ï¼šåœ¨çœŸå¯¦å•†å‹™å ´æ™¯ä¸­é‹ç”¨æ‰€å­¸æŠ€å·§
                
                ## ğŸ“ æœ¬æ¬¡è«‡åˆ¤çµ±è¨ˆæ•¸æ“š
                - **å”å•†è¼ªæ•¸**ï¼š${totalRounds}/${maxRounds}è¼ª
                - **ç­–ç•¥ç¨®é¡**ï¼š${totalStrategies}ç¨®ï¼ˆ${learningData.rounds.flatMap(r => r.analysis.strategyUsed).join('ã€') || 'åŸºç¤ç­–ç•¥'}ï¼‰
                - **å¹³å‡è¦ç´ ä½¿ç”¨**ï¼š${avgElementsUsed.toFixed(1)}å€‹/è¼ª
                - **è«‡åˆ¤è¤‡é›œåº¦**ï¼š${avgComplexity.toFixed(0)}åˆ†
                - **çªç™¼äº‹ä»¶**ï¼š${eventTriggered ? 'âœ… æˆåŠŸæ‡‰å°' : 'âŒ æœªé‡åˆ°'}
                - **æœ€çµ‚é¢¨æ ¼**ï¼š${learningData.style}
                
                ## ğŸ’¡ è©•åˆ†å…¬å¼é€æ˜åŒ–
                - **ç¸½é«”åˆ†æ•¸** = (æºé€š + ç­–ç•¥ + äº¤æ› + çµæœ) Ã· 4
                - **æºé€šåˆ†æ•¸** = 50 + å”ä½œæ€§çå‹µ + èªªç†çå‹µ
                - **ç­–ç•¥åˆ†æ•¸** = 40 + ç­–ç•¥æ•¸é‡Ã—20 + ç‰¹æ®Šç­–ç•¥çå‹µ  
                - **äº¤æ›åˆ†æ•¸** = è¦ç´ æ•¸é‡Ã—20 + è¤‡é›œåº¦åˆ†æ•¸
                - **çµæœåˆ†æ•¸** = 60 + BATNAçå‹µ + äº‹ä»¶æ‡‰å°çå‹µ
                
                ---
                *æ­¤å ±å‘ŠåŸºæ–¼${totalRounds}è¼ªå”å•†çš„è©³ç´°AIåˆ†æç”Ÿæˆï¼Œè©•åˆ†é‚è¼¯å®Œå…¨é€æ˜åŒ–ï¼Œæ—¨åœ¨å¹«åŠ©æ‚¨ç²¾æº–æå‡è«‡åˆ¤æŠ€å·§*
            `;
            
            const reportWindow = window.open('', '_blank');
            reportWindow.document.write(`
                <html>
                <head>
                    <title>è«‡åˆ¤å­¸ç¿’å ±å‘Š - è©³ç´°åˆ†æ</title>
                    <style>
                        body { 
                            font-family: 'Microsoft JhengHei', sans-serif; 
                            padding: 30px; 
                            line-height: 1.8; 
                            max-width: 900px; 
                            margin: 0 auto;
                            background: #f8f9fa;
                        }
                        .container {
                            background: white;
                            padding: 40px;
                            border-radius: 15px;
                            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
                        }
                        h1 { color: #2c5aa0; text-align: center; margin-bottom: 30px; }
                        h2 { color: #28a745; margin-top: 35px; border-bottom: 2px solid #28a745; padding-bottom: 10px; }
                        h3 { color: #2c5aa0; margin-top: 25px; }
                        ul { margin-left: 25px; }
                        li { margin-bottom: 8px; }
                        .score { font-size: 1.2em; font-weight: bold; color: #2c5aa0; }
                        .highlight { background: #fff3cd; padding: 10px; border-radius: 5px; margin: 10px 0; }
                        .excellent { color: #28a745; font-weight: bold; }
                        .good { color: #17a2b8; font-weight: bold; }
                        .poor { color: #dc3545; font-weight: bold; }
                        .formula { background: #e9ecef; padding: 15px; border-radius: 8px; font-family: monospace; }
                        @media print {
                            body { background: white; }
                            .container { box-shadow: none; }
                        }
                    </style>
                </head>
                <body>
                    <div class="container">
                        ${report.replace(/\n/g, '<br>')
                                .replace(/^# (.*?)$/gm, '<h1>$1</h1>')
                                .replace(/^## (.*?)$/gm, '<h2>$1</h2>')
                                .replace(/^### (.*?)$/gm, '<h3>$1</h3>')
                                .replace(/^â€¢ (.*?)$/gm, '<li>$1</li>')
                                .replace(/\*\*(.*?)\*\*/g, '<strong class="score">$1</strong>')
                                .replace(/- \*\*(.*?)\*\*/g, '- <span class="score">$1</span>')
                                .replace(/ï¼ˆå„ªç§€ï¼‰/g, '<span class="excellent">ï¼ˆå„ªç§€ï¼‰</span>')
                                .replace(/ï¼ˆè‰¯å¥½ï¼‰/g, '<span class="good">ï¼ˆè‰¯å¥½ï¼‰</span>')
                                .replace(/ï¼ˆéœ€åŠ å¼·ï¼‰/g, '<span class="poor">ï¼ˆéœ€åŠ å¼·ï¼‰</span>')}
                    </div>
                </body>
                </html>
            `);
        }
        
        function getItemLabel(key) {
            const labels = {
                price: 'åƒ¹æ ¼', quantity: 'æ•¸é‡', payment: 'ä»˜æ¬¾æ¢ä»¶', delivery: 'äº¤æœŸ',
                quality: 'å“è³ªæ¨™æº–', warranty: 'ä¿å›ºæœå‹™', volume: 'æœªä¾†åˆä½œé‡', exclusivity: 'åˆä½œæ¨¡å¼'
            };
            return labels[key] || key;
        }
        
        function updateStrategyTip() {
            const tips = [];
            
            if (batnaSettings.value === 'excellent') {
                tips.push('ğŸ’ª æ‚¨çš„BATNAå¾ˆå¼·ï¼Œå¯ä»¥æ›´æœ‰ä¿¡å¿ƒè«‡åˆ¤');
            } else if (batnaSettings.value === 'poor') {
                tips.push('âš ï¸ BATNAè¼ƒå¼±ï¼Œå»ºè­°æ¡ç”¨åˆä½œç­–ç•¥');
            }
            
            const roundAdvice = currentRound <= 2 ? 'å»ºç«‹è«‡åˆ¤åŸºèª¿ï¼Œå±•ç¾èª æ„' : 
                               currentRound <= 4 ? 'å°‹æ±‚å¹³è¡¡é»ï¼Œé€²è¡Œæ¢ä»¶äº¤æ›' : 'ä¿ƒæˆæœ€çµ‚å”è­°ï¼Œå±•ç¾å½ˆæ€§';
            tips.push(`ğŸª ç¬¬${currentRound}è¼ªå»ºè­°ï¼š${roundAdvice}`);
            
            const industry = document.getElementById('industry').value;
            if (industry && industryTemplates[industry]) {
                const template = industryTemplates[industry];
                tips.push(`ğŸ­ ${template.name}é‡é»ï¼š${template.keyFocus.join('ã€')}`);
            }
            
            tips.push('ğŸ¯ è¨˜ä½ï¼šå”å•†ä¸åªæ˜¯åƒ¹æ ¼ï¼Œå–„ç”¨æ¢ä»¶äº¤æ›å‰µé€ é›™è´');
            
            document.getElementById('current-tip').innerHTML = tips.join('<br>â€¢ ');
        }
        
        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            updateStrategyTip();
            updateScoreDisplay();
            updateExpertAdvice('opening');
        });
    </script>
</body>
</html>